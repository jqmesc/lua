-- game https://www.roblox.com/games/2000062521/State-of-Anarchy

-- // Library // --
local main_module = loadstring(game:HttpGet('https://raw.githubusercontent.com/Sinscrips/source_scripts/main/main_module_v2.lua', true))()
local library = main_module['Library']
local functions = main_module['Functions']
local esp = main_module['Esp']
local aimbot = main_module['Aimbot']
local message = main_module['Message']
local Keybind = main_module['Keybind']
local uis = game:GetService('UserInputService')
local cls = game:GetService('CollectionService')

-- // Variables // --
local _plr = game.Players.LocalPlayer;

getgenv()._client = { };

getgenv()._shared = { 
    Players = game.Workspace.Players;
    Connections = game.ReplicatedStorage.Connections;
    Casings = game.ReplicatedStorage.Casings;
    AimFolder = { };
    EspFolder = { };
};

local _settings = { 
    Weapon = {
        
    };
    Player = {
        Fly = false;
    };
    World = {
        Fullbright = false;
    };
};

-- // Functions // --
function _client:EditWeapon(v1, v2)
    
end

function _shared:ClearFolders()
    for i,v in pairs(self.AimFolder) do
        table.remove(self.AimFolder, i)
    end
    for i,v in pairs(self.EspFolder) do
        self.EspFolder[i] = nil
    end
    --print('folders cleared')
end
function _shared:UpdatedFolders()
    _shared:ClearFolders()
    for i,v in pairs(_shared.Players:GetChildren()) do
        if v.Name ~= _plr.Name then
            _shared.EspFolder[v] = v
            table.insert(_shared.AimFolder, v)
            --print('enemy player ' .. v.Name .. ' inserted')
        end
    end
    --warn('folders updated')
end

-- // GUI Frame 1 // --
local Frame1 = library:AddFrame({name='Gun Hax'})

Frame1:AddToggle('Disable Cooldown', function(v1)
    _settings.Weapon.Cooldown = v1
    _client:EditWeapon('Reload', v1 and 0);
end)

-- // GUI Frame 2 // --
local Frame2 = library:AddFrame({name='Plr Hax'})

local _esp
Frame2:AddToggle('Esp', function(v1)
    if v1 then
        _esp = esp.new({folder=_shared.EspFolder,color=Color3.fromRGB(255,0,0),distance=true})
        _shared:UpdatedFolders()
    else
        _esp:Remove()
    end
end)

local _aimbot
Frame2:AddToggle('Aimbot', function(v1)
    if v1 then
        _aimbot = aimbot.new({folder=_shared.AimFolder,smoothness=7})
        _shared:UpdatedFolders()
    else
        _aimbot:Remove()
    end
end)

local _fly = Frame2:AddToggle('Fly', function(v1)
    _settings.World.Fly = v1
    if v1 then
        local _bodyVelocity = Instance.new('BodyVelocity', _plr.Character.HumanoidRootPart)
		repeat game:GetService('RunService').RenderStepped:wait()

            if _plr.Character:FindFirstChild('HumanoidRootPart') and not _plr.Character.HumanoidRootPart:FindFirstChild('BodyVelocity') then
                _bodyVelocity = Instance.new('BodyVelocity', _plr.Character.HumanoidRootPart)
                --print('replaced body velocity')
            end
            
            local cam = game.Workspace.CurrentCamera.CFrame
			
			local v1 = Vector3.new()
			
			if uis:IsKeyDown(Enum.KeyCode.W) then
				v1 = v1 + Vector3.new(cam.LookVector.X, 0, cam.LookVector.Z)
			end
            if uis:IsKeyDown(Enum.KeyCode.LeftShift) then
				v1 = v1 + Vector3.new(cam.LookVector.X, 0, cam.LookVector.Z)*10
			end
			if uis:IsKeyDown(Enum.KeyCode.S) then
				v1 = v1 - Vector3.new(cam.LookVector.X, 0, cam.LookVector.Z)
			end
			if uis:IsKeyDown(Enum.KeyCode.D) then
				v1 = v1 + Vector3.new(cam.RightVector.X, 0, cam.RightVector.Z)
			end
			if uis:IsKeyDown(Enum.KeyCode.A) then
				v1 = v1 - Vector3.new(cam.RightVector.X, 0, cam.RightVector.Z)
			end
			if uis:IsKeyDown(Enum.KeyCode.Space) then
				v1 = v1 + Vector3.new(0, 1, 0)
			end
			if uis:IsKeyDown(Enum.KeyCode.LeftAlt) then
				v1 = v1 - Vector3.new(0, .5, 0)
			end

			_bodyVelocity.Velocity = v1 * 100
			
		until not _settings.fly
		_bodyVelocity:Destroy()
    end
end)

-- // GUI Frame 3 // --
local Frame3 = library:AddFrame({name='Env Hax'})

Frame3:AddButton('Kill All', function()
    for i,v in pairs(game.Workspace.Players:GetChildren()) do
        if v.Name ~= _plr.Name then
            _shared.Connections.HitEvent:FireServer(v.Head, Vector3.new(), Vector3.new(), v, _shared.Casings:GetChildren()[1], Vector3.new(), {})
        end
    end
end)

local _fb = game.Lighting.Ambient
Frame3:AddToggle('Fullbright', function(v1)
    game.Lighting.GlobalShadows = not v1;
    game.Lighting.Ambient = v1 and Color3.fromRGB(65,65,65) or _fb;
    if v1 then
        repeat game:GetService('RunService').RenderStepped:wait()
            if _plr.Character then
                local _light = _plr.Character.Head.PointLight
                _light.Brightness = 1;
                _light.Enabled = true;
                _light.Range = 60;
                _light.Shadows = false;
            end
        until not _settings.World.Fullbright;
        _plr.Character.Head.PointLight.Enabled = false;
    end
end)

Frame3:AddBox('Gravity', function(v1)
    game.Workspace.Gravity = tonumber(v1) or 196.2;
end)
-- // Keybinds // --
Keybind:NewBind(Enum.KeyCode.RightShift, function()
    library:Toggle()
end)
Keybind:NewBind(Enum.KeyCode.F, function()
    _fly:Toggle()
end)

-- // Player Spawn // --
_shared.Players.ChildAdded:connect(function(c)
    _shared:UpdatedFolders();
end)
_shared.Players.ChildRemoved:connect(function(c)
    _shared:UpdatedFolders();
end)